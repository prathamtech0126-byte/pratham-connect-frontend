Build a production-ready Backend for a CRM Application using Node.js, Express, PostgreSQL (with Drizzle ORM), and WebSockets (ws).

The backend must serve a frontend that handles complex immigration client data.

### 1. Database Schema (PostgreSQL)
Create the following tables using Drizzle ORM:

- users:
  - id, name, email (unique), password_hash, role (enum: 'superadmin', 'director', 'manager', 'team_lead', 'counsellor'), manager_id (self-relation for hierarchy), created_at.
  - refresh_token: Store the current refresh token here (hashed) or in a separate table if preferred.

- clients:
  - id, name, phone, email, enrollment_date.
  - sales_type (string: e.g., 'Canada Student', 'UK Spouse').
  - status (enum: 'Active', 'Pending', 'Completed', 'Dropped').
  - counsellor_id (FK to users), branch_name.

- client_financials:
  - client_id (FK), total_agreed_amount, total_received, pending_amount, currency (default 'INR').

- client_product_details:
  - client_id (FK), product_type (enum: 'spouse', 'student', 'visitor').
  - data (JSONB): *CRITICAL* This column must store dynamic form fields (e.g., marriage dates, IELTS scores) as a JSON object.

- activity_logs:
  - id, user_id (FK), action (string), description (text), timestamp.

### 2. Authentication (Secure with Refresh Tokens)
Implement a robust JWT (JSON Web Token) system:
- Access Token: Short-lived (e.g., 15 mins).
- Refresh Token: Long-lived (e.g., 7 days), stored securely.
- Endpoints:
  - POST /api/auth/register: Create new user (hash password with bcrypt).
  - POST /api/auth/login: Return Access + Refresh tokens.
  - POST /api/auth/refresh: Validate Refresh Token and issue new Access Token.
  - POST /api/auth/logout: Invalidate the token.
- Middleware: Create an `authenticateToken` middleware to protect routes.

### 3. API Endpoints
Implement RESTful APIs for the frontend:

- Clients:
  - POST /api/clients: Transactional insert. Must insert into `clients`, `client_financials`, and `client_product_details` tables simultaneously.
  - GET /api/clients: Support pagination and filtering by role (e.g., Counsellors see only their own clients).
  - GET /api/clients/:id: Fetch full profile including the JSONB product data.

- Team:
  - GET /api/users: List team members (Director sees all, Manager sees their team).

- Dashboard:
  - GET /api/dashboard/stats: Return aggregate counts (Total Revenue, Active Cases) for the user's role.

### 4. Real-Time WebSockets
- Set up a WebSocket server.
- Broadcast Event: When `POST /api/clients` is successful (new client added), broadcast a JSON message `{"type": "CLIENT_UPDATE", "action": "create"}` to all connected clients.
- Broadcast Event: When a client status changes, broadcast the update.

### 5. Tech Constraints
- Use strict TypeScript.
- Use Zod for validation on all API inputs.
- Ensure the JSONB column in `client_product_details` can handle nested structures (like `spouseFields.financeAndEmployment`).